<aside
  class="fixed left-0 top-0 z-40 h-screen bg-sidebar transition-all duration-300"
  [ngClass]="collapsed() ? 'w-16' : 'w-64'"
>
  <div class="flex h-full flex-col">
    <!-- Logo -->
    <div
      class="flex h-16 items-center gap-2 border-b border-sidebar-border px-4"
      [ngClass]="collapsed() ? 'justify-center px-2' : ''"
    >
      <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-primary-foreground"
        >
          <path d="m9 11 3 3L22 4" />
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
        </svg>
      </div>
      @if (!collapsed()) {
      <span class="text-lg font-semibold text-sidebar-foreground"> TaskFlow Pro </span>
      }
    </div>

    <!-- Main Navigation -->
    <nav class="flex-1 space-y-1 p-3">
      @for (item of navItems(); track item.path) {
      <a
        [routerLink]="item.path"
        routerLinkActive="bg-sidebar-accent text-sidebar-accent-foreground"
        [routerLinkActiveOptions]="{ exact: false }"
        class="flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-smooth relative text-sidebar-muted-foreground hover:bg-sidebar-muted hover:text-sidebar-foreground"
        [ngClass]="collapsed() ? 'justify-center px-2' : ''"
        [title]="collapsed() ? item.label : ''"
      >
        <lucide-icon [name]="item.icon" [size]="20" class="shrink-0"></lucide-icon>
        @if (!collapsed()) {
        <span>{{ item.label }}</span>
        } @if (item.badge && item.badge > 0) {
        <span
          class="flex h-5 min-w-5 items-center justify-center rounded-full bg-destructive text-[10px] font-medium text-destructive-foreground"
          [ngClass]="collapsed() ? 'absolute -top-1 -right-1 h-4 min-w-4' : 'ml-auto'"
        >
          {{ item.badge }}
        </span>
        }
      </a>
      }

      <!-- Admin link - only visible for admins -->
      @if (currentUser()?.role === UserRole.ADMIN) {
      <a
        routerLink="/admin"
        routerLinkActive="bg-sidebar-accent text-sidebar-accent-foreground"
        class="flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-smooth relative text-sidebar-muted-foreground hover:bg-sidebar-muted hover:text-sidebar-foreground"
        [ngClass]="collapsed() ? 'justify-center px-2' : ''"
        title="Admin"
      >
        <lucide-icon name="Shield" [size]="20" class="shrink-0"></lucide-icon>
        @if (!collapsed()) {
        <span>Admin</span>
        }
      </a>
      }
    </nav>

    <!-- Bottom Navigation -->
    <nav class="space-y-1 p-3 border-t border-sidebar-border">
      @for (item of bottomNavItems; track item.path) {
      <a
        [routerLink]="item.path"
        routerLinkActive="bg-sidebar-accent text-sidebar-accent-foreground"
        class="flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-smooth relative text-sidebar-muted-foreground hover:bg-sidebar-muted hover:text-sidebar-foreground"
        [ngClass]="collapsed() ? 'justify-center px-2' : ''"
        [title]="collapsed() ? item.label : ''"
      >
        <lucide-icon [name]="item.icon" [size]="20" class="shrink-0"></lucide-icon>
        @if (!collapsed()) {
        <span>{{ item.label }}</span>
        } @if (item.badge && item.badge > 0) {
        <span
          class="flex h-5 min-w-5 items-center justify-center rounded-full bg-destructive text-[10px] font-medium text-destructive-foreground"
          [ngClass]="collapsed() ? 'absolute -top-1 -right-1 h-4 min-w-4' : 'ml-auto'"
        >
          {{ item.badge }}
        </span>
        }
      </a>
      }
    </nav>

    <!-- User Section -->
    <div class="border-t border-sidebar-border p-3" [ngClass]="collapsed() ? 'px-2' : ''">
      <div
        class="rounded-lg bg-sidebar-muted p-3"
        [ngClass]="collapsed() ? 'p-2 flex justify-center' : ''"
      >
        @if (collapsed()) {
        <div
          class="h-8 w-8 rounded-full bg-primary flex items-center justify-center text-xs font-medium text-primary-foreground cursor-default"
          [title]="currentUser()?.email || ''"
        >
          {{ getInitials(currentUser()?.email || '') }}
        </div>
        } @else {
        <p class="text-xs text-sidebar-muted-foreground">Logged in as</p>
        <p class="text-sm font-medium text-sidebar-foreground truncate">
          {{ currentUser()?.email }}
        </p>
        @if (currentUser()?.role === UserRole.ADMIN) {
        <span
          class="inline-flex mt-1 items-center rounded-full bg-primary/20 px-2 py-0.5 text-[10px] font-medium text-primary"
        >
          Admin
        </span>
        } }
      </div>
    </div>

    <!-- Collapse Toggle -->
    <button
      (click)="toggleCollapse()"
      class="absolute -right-3 top-20 h-6 w-6 rounded-full border border-sidebar-border bg-sidebar text-sidebar-foreground shadow-sm hover:bg-sidebar-muted transition-colors"
    >
      @if (collapsed()) {
      <lucide-icon name="ChevronRight" [size]="12" class="mx-auto"></lucide-icon>
      } @else {
      <lucide-icon name="ChevronLeft" [size]="12" class="mx-auto"></lucide-icon>
      }
    </button>
  </div>
</aside>
